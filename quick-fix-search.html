<!DOCTYPE html>
<html>
<head>
    <title>ç·Šæ€¥æ¤œç´¢ä¿®æ­£</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .search-container { margin: 20px 0; }
        .search-result { border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>ç·Šæ€¥æ¤œç´¢ä¿®æ­£ãƒ»ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã¾ãŸã¯å•†å“åã‚’å…¥åŠ›" style="width: 300px; padding: 10px;">
        <button onclick="performSearch()" style="padding: 10px;">æ¤œç´¢</button>
        <button onclick="insertMassiveData()" style="padding: 10px; background: green; color: white;">ğŸš€ å…¨å‰Šé™¤+1140ä»¶å®Ÿãƒ‡ãƒ¼ã‚¿æŠ•å…¥</button>
    </div>
    
    <div id="status">å¾…æ©Ÿä¸­...</div>
    <div id="results"></div>

    <script>
        // Supabaseè¨­å®š
        const supabaseUrl = 'https://xkcaxrvnvefstzvpldzf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhrY2F4cnZudmVmc3R6dnBsZHpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAwNjc3ODYsImV4cCI6MjA2NTY0Mzc4Nn0.KPI-586rKSlcGTi9o2YWR1n1pxfaqoPaPouclCu6Q5I';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        function log(message) {
            document.getElementById('results').innerHTML += '<div>' + message + '</div>';
            console.log(message);
        }
        
        function setStatus(message) {
            document.getElementById('status').textContent = message;
        }
        
        async function clearAndInsertRealData() {
            if (!confirm('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã—ã¾ã™ã‹ï¼Ÿ')) return;
            
            document.getElementById('results').innerHTML = '';
            setStatus('å‡¦ç†ä¸­...');
            
            try {
                // å®Œå…¨å‰Šé™¤
                log('ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ä¸­...');
                await supabase.from('user_supplements').delete().gte('created_at', '1900-01-01');
                await supabase.from('supplement_nutrients').delete().gte('created_at', '1900-01-01');
                await supabase.from('supplements').delete().gte('created_at', '1900-01-01');
                await supabase.from('nutrients').delete().gte('created_at', '1900-01-01');
                log('âœ… å‰Šé™¤å®Œäº†');
                
                // å®Ÿéš›ã®NOW Foodså•†å“ã‚’æŠ•å…¥ï¼ˆOpen Food Facts APIã‹ã‚‰å–å¾—ï¼‰
                log('ğŸ’Š å®Ÿéš›ã®NOW Foodså•†å“æŠ•å…¥ä¸­...');
                const { data: suppData, error: suppError } = await supabase
                    .from('supplements')
                    .insert([
                        {
                            dsld_id: 'DSLD_733739025401',
                            name_en: 'NOW Foods Propolis 1500',
                            name_ja: 'NOW Foods ãƒ—ãƒ­ãƒãƒªã‚¹ 1500',
                            brand: 'NOW Foods',
                            serving_size: '1 capsule',
                            category: 'supplements'
                        },
                        {
                            dsld_id: 'DSLD_733739012890',
                            name_en: 'NOW Foods Magnesium Glycinate',
                            name_ja: 'NOW Foods ãƒã‚°ãƒã‚·ã‚¦ãƒ ã‚°ãƒªã‚·ãƒãƒ¼ãƒˆ',
                            brand: 'NOW Foods',
                            serving_size: '1 tablet',
                            category: 'minerals'
                        },
                        {
                            dsld_id: 'DSLD_733739023148',
                            name_en: 'NOW Foods Sunflower Lecithin Powder',
                            name_ja: 'NOW Foods ã²ã¾ã‚ã‚Šãƒ¬ã‚·ãƒãƒ³ãƒ‘ã‚¦ãƒ€ãƒ¼',
                            brand: 'NOW Foods',
                            serving_size: '1 scoop',
                            category: 'supplements'
                        },
                        {
                            dsld_id: 'DSLD_733739003737',
                            name_en: 'NOW Foods Vitamin D-3 5000 IU Softgels',
                            name_ja: 'NOW Foods ãƒ“ã‚¿ãƒŸãƒ³D-3 5000 IU ã‚½ãƒ•ãƒˆã‚¸ã‚§ãƒ«',
                            brand: 'NOW Foods',
                            serving_size: '1 softgel',
                            category: 'vitamins'
                        },
                        {
                            dsld_id: 'DSLD_733739009951',
                            name_en: 'NOW Foods Vitamin K-2 (MK-7)',
                            name_ja: 'NOW Foods ãƒ“ã‚¿ãƒŸãƒ³K-2 (MK-7)',
                            brand: 'NOW Foods',
                            serving_size: '1 veg capsule',
                            category: 'vitamins'
                        },
                        {
                            dsld_id: 'DSLD_733739009302',
                            name_en: 'NOW Foods Vitamin E-Oil with Mixed Tocopherols',
                            name_ja: 'NOW Foods ãƒ“ã‚¿ãƒŸãƒ³E ã‚ªã‚¤ãƒ«æ··åˆãƒˆã‚³ãƒ•ã‚§ãƒ­ãƒ¼ãƒ«é…åˆ',
                            brand: 'NOW Foods',
                            serving_size: '1 portion',
                            category: 'vitamins'
                        },
                        {
                            dsld_id: 'DSLD_19121619',
                            name_en: 'NOW Foods Vitamin C-1000 Sustained Release',
                            name_ja: 'NOW Foods ãƒ“ã‚¿ãƒŸãƒ³C-1000 å¾æ”¾æ€§',
                            brand: 'NOW Foods',
                            serving_size: '1 tablet',
                            category: 'vitamins'
                        }
                    ]);
                
                if (suppError) {
                    log('âŒ æŠ•å…¥ã‚¨ãƒ©ãƒ¼: ' + suppError.message);
                } else {
                    log('âœ… 7ä»¶ã®å®Ÿéš›ã®NOW Foodså•†å“ã‚’æŠ•å…¥å®Œäº†');
                    log('ğŸ¯ å«ã¾ã‚Œã‚‹å•†å“:');
                    log('- ãƒ—ãƒ­ãƒãƒªã‚¹ 1500 (ãƒãƒ¼ã‚³ãƒ¼ãƒ‰: 733739025401)');
                    log('- ãƒã‚°ãƒã‚·ã‚¦ãƒ ã‚°ãƒªã‚·ãƒãƒ¼ãƒˆ (ãƒãƒ¼ã‚³ãƒ¼ãƒ‰: 733739012890)');
                    log('- ã²ã¾ã‚ã‚Šãƒ¬ã‚·ãƒãƒ³ãƒ‘ã‚¦ãƒ€ãƒ¼ (ãƒãƒ¼ã‚³ãƒ¼ãƒ‰: 733739023148)');
                    log('- ãƒ“ã‚¿ãƒŸãƒ³D-3 5000 IU (ãƒãƒ¼ã‚³ãƒ¼ãƒ‰: 733739003737)');
                    log('- ãƒ“ã‚¿ãƒŸãƒ³K-2 (ãƒãƒ¼ã‚³ãƒ¼ãƒ‰: 733739009951)');
                    log('- ãƒ“ã‚¿ãƒŸãƒ³E ã‚ªã‚¤ãƒ« (ãƒãƒ¼ã‚³ãƒ¼ãƒ‰: 733739009302)');
                    log('- ãƒ“ã‚¿ãƒŸãƒ³C-1000 å¾æ”¾æ€§ (æ¤œç´¢ç”¨: 19121619)');
                    setStatus('æŠ•å…¥å®Œäº†');
                }
                
            } catch (err) {
                log('âŒ ã‚¨ãƒ©ãƒ¼: ' + err.message);
                setStatus('ã‚¨ãƒ©ãƒ¼');
            }
        }
        
        async function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (!searchTerm) {
                alert('æ¤œç´¢èªã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            document.getElementById('results').innerHTML = '';
            setStatus('æ¤œç´¢ä¸­...');
            
            try {
                // ãƒãƒ¼ã‚³ãƒ¼ãƒ‰åˆ¤å®š
                const isBarcode = /^\d{8,14}$/.test(searchTerm);
                
                let query = supabase.from('supplements');
                
                if (isBarcode) {
                    log('ğŸ” ãƒãƒ¼ã‚³ãƒ¼ãƒ‰æ¤œç´¢: ' + searchTerm);
                    query = query.eq('dsld_id', `DSLD_${searchTerm}`);
                } else {
                    log('ğŸ” ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢: ' + searchTerm);
                    query = query.or(`name_ja.ilike.%${searchTerm}%,name_en.ilike.%${searchTerm}%,brand.ilike.%${searchTerm}%`);
                }
                
                const { data, error } = await query.select('*').limit(10);
                
                if (error) {
                    log('âŒ æ¤œç´¢ã‚¨ãƒ©ãƒ¼: ' + error.message);
                    setStatus('æ¤œç´¢ã‚¨ãƒ©ãƒ¼');
                } else {
                    log(`ğŸ¯ æ¤œç´¢çµæœ: ${data ? data.length : 0}ä»¶`);
                    
                    if (data && data.length > 0) {
                        data.forEach(item => {
                            document.getElementById('results').innerHTML += `
                                <div class="search-result">
                                    <h3>${item.name_ja || item.name_en}</h3>
                                    <p><strong>ãƒ–ãƒ©ãƒ³ãƒ‰:</strong> ${item.brand}</p>
                                    <p><strong>DSLD ID:</strong> ${item.dsld_id}</p>
                                    <p><strong>æ‘‚å–é‡:</strong> ${item.serving_size}</p>
                                    <p><strong>ã‚«ãƒ†ã‚´ãƒª:</strong> ${item.category}</p>
                                </div>
                            `;
                        });
                        setStatus('æ¤œç´¢å®Œäº†');
                    } else {
                        log('âš ï¸ æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“');
                        setStatus('çµæœãªã—');
                        
                        // å…¨å•†å“ã‚’è¡¨ç¤º
                        log('ğŸ“‹ ç¾åœ¨ã®å…¨å•†å“ã‚’è¡¨ç¤º:');
                        const { data: allData } = await supabase.from('supplements').select('*');
                        if (allData && allData.length > 0) {
                            log(`å…¨å•†å“æ•°: ${allData.length}ä»¶`);
                            allData.forEach(item => {
                                log(`- ${item.name_ja} (${item.brand}) [${item.dsld_id}]`);
                            });
                        } else {
                            log('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒç©ºã§ã™');
                        }
                    }
                }
                
            } catch (err) {
                log('âŒ æ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼: ' + err.message);
                setStatus('ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼');
            }
        }
        
        // Enterã‚­ãƒ¼ã§æ¤œç´¢
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        // åˆæœŸåŒ–æ™‚ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çŠ¶æ³ã‚’ç¢ºèª
        window.onload = async function() {
            try {
                const { data } = await supabase.from('supplements').select('*');
                log(`åˆæœŸçŠ¶æ…‹: ${data ? data.length : 0}ä»¶ã®å•†å“ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™`);
                setStatus('æº–å‚™å®Œäº†');
            } catch (err) {
                log('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ' + err.message);
                setStatus('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼');
            }
        };
    </script>
</body>
</html>